# Cursor Rules - Programme de Formation Architecture PHP

## ğŸ¯ Vue d'ensemble du projet

Ce projet est un programme de formation pour dÃ©veloppeurs PHP axÃ© sur l'architecture logicielle. Il utilise des sessions de 2h avec des challenges pratiques oÃ¹ les dÃ©veloppeurs Ã©crivent du code de production pour faire passer des tests unitaires prÃ©-Ã©crits.

## ğŸ“ Structure du projet

```
PHP/
â”œâ”€â”€ challenges/
â”‚   â”œâ”€â”€ session-00/          # Initiation aux Tests Unitaires
â”‚   â”œâ”€â”€ session-01/          # Refactoring (SRP)
â”‚   â”œâ”€â”€ session-02/          # Dependency Injection
â”‚   â”œâ”€â”€ session-03/          # Factory Pattern
â”‚   â”œâ”€â”€ session-04/          # Strategy Pattern
â”‚   â””â”€â”€ session-XX/          # Nouvelles sessions
â”œâ”€â”€ composer.json            # Configuration PHP et dÃ©pendances
â”œâ”€â”€ phpunit.xml             # Configuration PHPUnit
â”œâ”€â”€ phpstan.neon            # Configuration PHPStan
â”œâ”€â”€ phpcs.xml               # Configuration PHP CodeSniffer
â”œâ”€â”€ docker-compose.yml      # Environnement Docker
â”œâ”€â”€ Dockerfile              # Image Docker PHP
â””â”€â”€ README.md               # Documentation principale
```

## ğŸ—ï¸ Conventions pour les nouvelles sessions

### Nommage des sessions
- **Format** : `session-XX` oÃ¹ XX est un numÃ©ro Ã  2 chiffres (00, 01, 02, etc.)
- **Ordre** : Session 00 = Initiation aux tests, puis sessions d'architecture
- **Exemple** : `session-05`, `session-06`, etc.

### Structure d'une session
```
challenges/session-XX/
â”œâ”€â”€ README.md               # Documentation complÃ¨te de la session
â”œâ”€â”€ src/                    # Code source (classes problÃ©matiques)
â”‚   â””â”€â”€ [ClassePrincipale].php
â””â”€â”€ tests/                  # Tests unitaires guidants
    â””â”€â”€ [ClassePrincipale]Test.php
```

### Conventions de nommage des classes
- **Namespace source** : `SessionXX\` (ex: `Session05\`)
- **Namespace tests** : `SessionXXTests\` (ex: `Session05Tests\`)
- **Classes principales** : Nom descriptif du pattern/concept (ex: `UserRepository`, `PaymentService`)
- **Tests** : `[ClassePrincipale]Test` (ex: `UserRepositoryTest`)

## ğŸ“ Template de README pour nouvelle session

```markdown
# Session XX : [Nom du Pattern/Concept]

## ğŸ¯ Objectif de la Session
[Description claire de l'objectif]

## ğŸ“‹ ProblÃ¨me Ã  RÃ©soudre

### Code de DÃ©part (ProblÃ©matique)
[Code avec problÃ¨me architectural]

### ProblÃ¨mes IdentifiÃ©s
1. [ProblÃ¨me 1]
2. [ProblÃ¨me 2]
3. [ProblÃ¨me 3]

## ğŸ¯ Objectif du Refactoring

### Solution Cible ([Pattern])
[Code cible avec le pattern implÃ©mentÃ©]

## ğŸ§ª Tests Ã  Faire Passer
[Liste des tests fournis]

## ğŸ“š Concepts ClÃ©s Ã  MaÃ®triser
[Concepts thÃ©oriques]

## ğŸ› ï¸ ProcÃ©dure DÃ©taillÃ©e pour les DÃ©veloppeurs
[Ã‰tapes pas Ã  pas]

## ğŸ¯ RÃ©sultats Attendus
[Avant/AprÃ¨s]

## ğŸš€ Application ImmÃ©diate
[Utilisation dans les projets]

## ğŸ“– Ressources ComplÃ©mentaires
[Liens utiles]

## ğŸ¯ DÃ©fi Final
[Objectif et contraintes]
```

## ğŸ§ª Conventions pour les tests

### Structure des tests
- **1 test complet** comme exemple (sans TODO)
- **Tests avec TODOs** pour guider l'implÃ©mentation
- **Tests d'exceptions** avec `expectException()`
- **Tests de cas limites** (valeurs nulles, nÃ©gatives, extrÃªmes)
- **Tests de flexibilitÃ©** (changement de comportement)

### Nommage des mÃ©thodes de test
- **Format** : `test[MethodName]With[Scenario]()`
- **Exemples** :
  - `testAddWithPositiveNumbers()`
  - `testCalculateDiscountWithNegativePriceThrowsException()`
  - `testSendEmailNotificationSuccess()`

### Assertions recommandÃ©es
- `assertEquals($expected, $actual)` - Ã‰galitÃ© de valeur
- `assertSame($expected, $actual)` - IdentitÃ© (type + valeur)
- `assertTrue($condition)` - Condition vraie
- `assertFalse($condition)` - Condition fausse
- `assertNull($value)` - Valeur nulle
- `assertNotNull($value)` - Valeur non nulle
- `expectException(ExceptionClass::class)` - Exception attendue

## âš™ï¸ Configuration requise pour nouvelle session

### 1. Mise Ã  jour composer.json
```json
"autoload": {
    "psr-4": {
        "SessionXX\\": "challenges/session-XX/src/"
    }
},
"autoload-dev": {
    "psr-4": {
        "SessionXXTests\\": "challenges/session-XX/tests/"
    }
},
"scripts": {
    "cs-check": "phpcs --standard=PSR12 ... challenges/session-XX/src/",
    "cs-fix": "phpcbf --standard=PSR12 ... challenges/session-XX/src/"
}
```

### 2. Mise Ã  jour phpunit.xml
```xml
<testsuites>
    <testsuite name="Session XX - [Nom du Pattern]">
        <directory>challenges/session-XX/tests</directory>
    </testsuite>
</testsuites>

<coverage>
    <include>
        <directory suffix=".php">challenges/session-XX/src</directory>
    </include>
    <exclude>
        <directory>challenges/session-XX/tests</directory>
        <file>challenges/session-XX/src/[ClasseProblematique].php</file>
    </exclude>
</coverage>
```

### 3. Mise Ã  jour phpstan.neon
```yaml
parameters:
    paths:
        - challenges/session-XX/src
    excludePaths:
        - challenges/session-XX/tests
```

### 4. Mise Ã  jour phpcs.xml
```xml
<file>challenges/session-XX/src</file>
```

## ğŸ¯ Patterns et concepts couverts

### Sessions existantes
- **Session 00** : Initiation aux Tests Unitaires
- **Session 01** : Refactoring (Single Responsibility Principle)
- **Session 02** : Dependency Injection / Inversion of Control
- **Session 03** : Factory Pattern
- **Session 04** : Strategy Pattern

### Sessions Ã  venir (selon le plan)
- **Session 05** : Repository Pattern
- **Session 06** : Service Layer Pattern
- **Session 07** : DTOs (Data Transfer Objects)
- **Session 08** : Command Pattern
- **Session 09** : Observer Pattern
- **Session 10** : Decorator Pattern
- **Session 11** : Adapter Pattern
- **Session 12** : Facade Pattern
- **Session 13** : CQRS (Command Query Responsibility Segregation)
- **Session 14** : Event Sourcing
- **Session 15** : Hexagonal Architecture
- **Session 16** : Microservices Architecture

## ğŸš€ ProcÃ©dure pour ajouter une nouvelle session

### 1. CrÃ©er la structure
```bash
mkdir -p challenges/session-XX/src
mkdir -p challenges/session-XX/tests
```

### 2. CrÃ©er les fichiers
- `challenges/session-XX/README.md` (copier le template)
- `challenges/session-XX/src/[ClassePrincipale].php` (code problÃ©matique)
- `challenges/session-XX/tests/[ClassePrincipale]Test.php` (tests guidants)

### 3. Mettre Ã  jour la configuration
- `composer.json` (autoload, scripts)
- `phpunit.xml` (testsuite, coverage)
- `phpstan.neon` (paths)
- `phpcs.xml` (files)

### 4. Tester l'environnement
```bash
docker compose exec php bash -c "composer dump-autoload"
docker compose exec php bash -c "./vendor/bin/phpunit --list-suites"
docker compose exec php bash -c "./vendor/bin/phpunit --testsuite='Session XX - [Nom]'"
```

### 5. Commit
```bash
git add .
git commit -m "feat: Session XX - [Nom du Pattern]

- Ajout du challenge Session XX : [Description]
- ProblÃ¨me : [Description du problÃ¨me]
- Objectif : [Description de l'objectif]
- Tests unitaires complets avec mocks pour guider l'implÃ©mentation
- Configuration mise Ã  jour : composer.json, phpunit.xml, phpstan.neon, phpcs.xml
- Documentation dÃ©taillÃ©e avec procÃ©dure pour les dÃ©veloppeurs
- Exemples concrets : [Liste des exemples]

Les dÃ©veloppeurs doivent :
1. [Ã‰tape 1]
2. [Ã‰tape 2]
3. [Ã‰tape 3]
4. [Ã‰tape 4]
5. [Ã‰tape 5]"
```

## ğŸ¯ Principes pÃ©dagogiques

### Approche progressive
- **Session 00** : Fondamentaux des tests
- **Sessions 01-04** : Patterns de base
- **Sessions 05-08** : Architecture en couches
- **Sessions 09-12** : Patterns avancÃ©s
- **Sessions 13-16** : Architecture moderne

### MÃ©thode d'apprentissage
1. **ProblÃ¨me concret** : Code avec problÃ¨me architectural
2. **Tests guidants** : Tests qui Ã©chouent et guident vers la solution
3. **Solution progressive** : ImplÃ©mentation Ã©tape par Ã©tape
4. **Application immÃ©diate** : Utilisation dans les projets rÃ©els
5. **Quick wins** : BÃ©nÃ©fices immÃ©diats

### QualitÃ© du code
- **PSR-12** : Standards de codage PHP
- **PHPStan level 8** : Analyse statique stricte
- **Tests unitaires** : Couverture de code
- **Documentation** : README dÃ©taillÃ© pour chaque session

## ğŸ”§ Environnement technique

### Docker
- **Base** : `php:8.1-fpm-alpine`
- **Extensions** : pdo, pdo_sqlite, zip
- **Outils** : Composer, Git

### DÃ©pendances PHP
- **PHPUnit 10** : Framework de tests
- **Mockery** : CrÃ©ation de mocks
- **PHPStan** : Analyse statique
- **PHP CodeSniffer** : Standards de code
- **PHP CS Fixer** : Correction automatique

### Commandes utiles
```bash
# Tests
docker compose exec php bash -c "./vendor/bin/phpunit"
docker compose exec php bash -c "./vendor/bin/phpunit --testsuite='Session XX'"

# QualitÃ©
docker compose exec php bash -c "composer cs-check"
docker compose exec php bash -c "composer cs-fix"
docker compose exec php bash -c "composer phpstan"

# Autoload
docker compose exec php bash -c "composer dump-autoload"
```

## ğŸ“š Ressources de rÃ©fÃ©rence

### Documentation
- [PHPUnit Documentation](https://phpunit.readthedocs.io/)
- [PSR-12 Coding Standard](https://www.php-fig.org/psr/psr-12/)
- [PHPStan Rules](https://phpstan.org/rules)

### Patterns
- [Refactoring Guru](https://refactoring.guru/)
- [Design Patterns](https://en.wikipedia.org/wiki/Design_Patterns)
- [SOLID Principles](https://en.wikipedia.org/wiki/SOLID)

### Architecture
- [Clean Architecture](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html)
- [Hexagonal Architecture](https://alistair.cockburn.us/hexagonal-architecture/)
- [CQRS](https://martinfowler.com/bliki/CQRS.html)

---

## ğŸ¯ RÃ¨gles importantes Ã  respecter

1. **Ne jamais fournir le code de solution** - Les dÃ©veloppeurs doivent l'Ã©crire
2. **Tests qui Ã©chouent au dÃ©part** - C'est normal et attendu
3. **Documentation complÃ¨te** - Chaque session doit Ãªtre autonome
4. **Exemples concrets** - Applicables immÃ©diatement dans les projets
5. **Progression logique** - Chaque session s'appuie sur les prÃ©cÃ©dentes
6. **QualitÃ© du code** - Respecter PSR-12 et PHPStan level 8
7. **Tests complets** - Couvrir tous les cas (succÃ¨s, erreurs, limites)
8. **Mocks comme objectif** - Les mocks sont la rÃ©compense du refactoring

Ces rÃ¨gles garantissent la cohÃ©rence et la qualitÃ© du programme de formation.
